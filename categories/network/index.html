<!doctype html>
<html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta><title>Category: network - wikix</title><link rel="manifest" href="/manifest.json"><meta name="application-name" content="wikix"><meta name="msapplication-TileImage" content="/img/favicon.svg"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-title" content="wikix"><meta name="apple-mobile-web-app-status-bar-style" content="default"><meta name="description" content="a boring backend developer who has a big dream"><meta property="og:type" content="blog"><meta property="og:title" content="wikix"><meta property="og:url" content="http://wikix.github.io/"><meta property="og:site_name" content="wikix"><meta property="og:description" content="a boring backend developer who has a big dream"><meta property="og:locale" content="en_US"><meta property="og:image" content="http://wikix.github.io/img/og_image.png"><meta property="article:author" content="wikix"><meta property="article:tag" content="linux,docker,kubernetes,network,kernel"><meta property="twitter:card" content="summary"><meta property="twitter:image" content="/img/og_image.png"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"http://wikix.github.io"},"headline":"wikix","image":["http://wikix.github.io/img/og_image.png"],"author":{"@type":"Person","name":"wikix"},"description":"a boring backend developer who has a big dream"}</script><link rel="icon" href="/img/favicon.svg"><link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.12.0/css/all.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@9.12.0/styles/atom-one-light.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@400;600&amp;family=Source+Code+Pro"><link rel="stylesheet" href="/css/default.css"><style>body>.footer,body>.navbar,body>.section{opacity:0}</style><!--!--><!--!--><!--!--><!--!--><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/css/lightgallery.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/css/justifiedGallery.min.css"><!--!--><!--!--><script src="https://cdn.jsdelivr.net/npm/pace-js@1.0.2/pace.min.js"></script><!--!--><!--!--><meta name="generator" content="Hexo 5.4.0"></head><body class="is-2-column"><nav class="navbar navbar-main"><div class="container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href="/"><img src="/img/favicon.svg" alt="wikix" height="28"></a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item" href="/">Home</a><a class="navbar-item" href="/archives">Archives</a><a class="navbar-item" href="/categories">Categories</a><a class="navbar-item" href="/tags">Tags</a><a class="navbar-item" href="/about">About</a></div><div class="navbar-end"><a class="navbar-item" target="_blank" rel="noopener" title="follow me on GitHub" href="https://github.com/wikix"><i class="fab fa-github"></i></a><a class="navbar-item search" title="Search" href="javascript:;"><i class="fas fa-search"></i></a></div></div></div></nav><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main is-8-tablet is-8-desktop is-8-widescreen"><div class="card"><div class="card-content"><nav class="breadcrumb" aria-label="breadcrumbs"><ul><li><a href="/categories">Categories</a></li><li class="is-active"><a href="#" aria-current="page">network</a></li></ul></nav></div></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Posted&nbsp;<time dateTime="2021-03-08T16:17:05.000Z" title="3/9/2021, 12:17:05 AM">2021-03-08</time></span><span class="level-item">Updated&nbsp;<time dateTime="2021-03-08T08:26:57.692Z" title="3/8/2021, 4:26:57 PM">2021-03-08</time></span><span class="level-item"><a class="link-muted" href="/categories/network/">network</a></span><span class="level-item">20 minutes read (About 2988 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2021/03/09/TCP-IP-%E7%9F%A5%E8%AF%86%E7%82%B9/">TCP/IP 知识点</a></h1><div class="content"><p>tcp/ip 知识点</p>
<p><img src="/images/tcp-1.png" alt="tcp-1"></p>
<p>linux 简单的命令访问网站并返回http数据包信息示例</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 建立一个非 浏览器 的 http 连接并读取返回信息</span></span><br><span class="line">exec 8&lt;&gt; /dev/tcp/www.baidu.com/80</span><br><span class="line">echo -e &#x27;GET / HTTP/1.0\n&#x27; 1&gt;&amp; 8</span><br><span class="line">cat &lt;&amp;8</span><br><span class="line"></span><br><span class="line">获取到baidu HTTP协议返回信息</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> linux 进程打开 socket/inode等文件描述（本质：文件系统）</span></span><br><span class="line">[root@master1 fd]# ps -ef| grep kubelet</span><br><span class="line">root      1538  1513  2 Jun22 ?        1-20:53:43 kube-apiserver --advertise-address=10.33.41.132 --allow-privileged=true --authentication-token-webhook-config-file=/etc/kubernetes/configs/authwebhookconfig.yaml --authorization-mode=Node,RBAC --client-ca-file=/etc/kubernetes/pki/ca.crt --enable-admission-plugins=NodeRestriction --enable-bootstrap-token-auth=true --etcd-cafile=/etc/kubernetes/pki/etcd/ca.crt --etcd-certfile=/etc/kubernetes/pki/apiserver-etcd-client.crt --etcd-keyfile=/etc/kubernetes/pki/apiserver-etcd-client.key --etcd-servers=https://127.0.0.1:2379 --event-ttl=12h --feature-gates=TaintBasedEvictions=false,TTLAfterFinished=true --insecure-port=0 --kubelet-client-certificate=/etc/kubernetes/pki/apiserver-kubelet-client.crt --kubelet-client-key=/etc/kubernetes/pki/apiserver-kubelet-client.key --kubelet-preferred-address-types=InternalIP,ExternalIP,Hostname --proxy-client-cert-file=/etc/kubernetes/pki/front-proxy-client.crt --proxy-client-key-file=/etc/kubernetes/pki/front-proxy-client.key --requestheader-allowed-names=front-proxy-client --requestheader-client-ca-file=/etc/kubernetes/pki/front-proxy-ca.crt --requestheader-extra-headers-prefix=X-Remote-Extra- --requestheader-group-headers=X-Remote-Group --requestheader-username-headers=X-Remote-User --secure-port=6443 --service-account-key-file=/etc/kubernetes/pki/sa.pub --service-cluster-ip-range=10.96.0.0/12 --service-node-port-range=30000-32767 --tls-cert-file=/etc/kubernetes/pki/apiserver.crt --tls-cipher-suites=TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256 --tls-min-version=VersionTLS12 --tls-private-key-file=/etc/kubernetes/pki/apiserver.key</span><br><span class="line">root      6914     1  3 Jun22 ?        2-05:27:31 /usr/bin/kubelet --bootstrap-kubeconfig=/etc/kubernetes/bootstrap-kubelet.conf --kubeconfig=/etc/kubernetes/kubelet.conf --config=/var/lib/kubelet/config.yaml --cgroup-driver=systemd --dynamic-config-dir=/var/lib/kubelet/dynamic --network-plugin=cni --node-ip=10.33.41.132 --pod-infra-container-image=docker.hikcloud:30001/k8ss/pause:3.1 --root-dir=/var/lib/kubelet</span><br><span class="line">root     31042 16717  0 10:35 pts/1    00:00:00 grep --color=auto kubelet</span><br><span class="line">[root@master1 fd]# cd /proc/6914/fd</span><br><span class="line">[root@master1 fd]# ls -l</span><br><span class="line">total 0</span><br><span class="line">lr-x------ 1 root root 64 Aug 31 10:08 0 -&gt; /dev/null</span><br><span class="line">lrwx------ 1 root root 64 Aug 31 10:08 1 -&gt; socket:[123625]</span><br><span class="line">l-wx------ 1 root root 64 Aug 31 10:08 10 -&gt; pipe:[125488]</span><br><span class="line">lrwx------ 1 root root 64 Aug 31 10:08 11 -&gt; socket:[124397]</span><br><span class="line">lrwx------ 1 root root 64 Aug 31 10:08 12 -&gt; socket:[124404]</span><br><span class="line">lrwx------ 1 root root 64 Aug 31 10:08 13 -&gt; socket:[169557354]</span><br><span class="line">lrwx------ 1 root root 64 Aug 31 10:08 14 -&gt; socket:[125570]</span><br><span class="line">lr-x------ 1 root root 64 Aug 31 10:08 15 -&gt; anon_inode:inotify</span><br><span class="line">lrwx------ 1 root root 64 Aug 31 10:08 16 -&gt; socket:[230272123]</span><br><span class="line">lrwx------ 1 root root 64 Aug 31 10:08 17 -&gt; socket:[125528]</span><br><span class="line">lrwx------ 1 root root 64 Aug 31 10:08 18 -&gt; socket:[125529]</span><br><span class="line">lrwx------ 1 root root 64 Aug 31 10:08 19 -&gt; socket:[122620]</span><br><span class="line">lrwx------ 1 root root 64 Aug 31 10:08 2 -&gt; socket:[123625]</span><br><span class="line">lrwx------ 1 root root 64 Aug 31 10:08 20 -&gt; socket:[122621]</span><br><span class="line">lr-x------ 1 root root 64 Aug 31 10:08 21 -&gt; anon_inode:inotify</span><br><span class="line">lrwx------ 1 root root 64 Aug 31 10:08 22 -&gt; anon_inode:[eventpoll]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 查看相关文件描述符</span></span><br><span class="line">[root@master1 fd]# lsof -p 6914</span><br><span class="line">COMMAND  PID USER   FD      TYPE             DEVICE  SIZE/OFF      NODE NAME</span><br><span class="line">kubelet 6914 root  cwd       DIR              254,0       224        64 /</span><br><span class="line">kubelet 6914 root  rtd       DIR              254,0       224        64 /</span><br><span class="line">kubelet 6914 root  txt       REG              254,0 111568408 403332145 /usr/bin/kubelet</span><br><span class="line">kubelet 6914 root  mem       REG              254,0     61624     36683 /usr/lib64/libnss_files-2.17.so</span><br><span class="line">kubelet 6914 root  mem       REG              254,0   2151672     36665 /usr/lib64/libc-2.17.so</span><br><span class="line">kubelet 6914 root  mem       REG              254,0     19288     36671 /usr/lib64/libdl-2.17.so</span><br><span class="line">kubelet 6914 root  mem       REG              254,0    141968     36691 /usr/lib64/libpthread-2.17.so</span><br><span class="line">kubelet 6914 root  mem       REG              254,0    163400     36658 /usr/lib64/ld-2.17.so</span><br><span class="line">kubelet 6914 root    0r      CHR                1,3       0t0      6352 /dev/null</span><br><span class="line">kubelet 6914 root    1u     unix 0xffff88c912dbd400       0t0    123625 socket</span><br><span class="line">kubelet 6914 root    2u     unix 0xffff88c912dbd400       0t0    123625 socket</span><br><span class="line">kubelet 6914 root    3u     unix 0xffff88ca94f53c00       0t0    124265 @00071</span><br><span class="line">kubelet 6914 root    4u  a_inode               0,10         0      6348 [eventpoll]</span><br><span class="line">kubelet 6914 root    5u     unix 0xffff88c8f5b23800       0t0    122558 socket</span><br><span class="line">kubelet 6914 root    6r  a_inode               0,10         0      6348 inotify</span><br><span class="line">kubelet 6914 root    7u     unix 0xffff88cac1311000       0t0    123654 socket</span><br><span class="line">kubelet 6914 root    8u  a_inode               0,10         0      6348 [eventpoll]</span><br><span class="line">kubelet 6914 root    9r     FIFO                0,9       0t0    125488 pipe</span><br><span class="line">kubelet 6914 root   10w     FIFO                0,9       0t0    125488 pipe</span><br><span class="line">kubelet 6914 root   11u     unix 0xffff88ca94f51800       0t0    124397 /var/run/387454838</span><br><span class="line">kubelet 6914 root   12u     IPv4             124404       0t0       TCP localhost:42420 (LISTEN)</span><br><span class="line">kubelet 6914 root   13u     IPv6          169557354       0t0       TCP master1:10250-&gt;master3:64790 (ESTABLISHED)</span><br><span class="line">kubelet 6914 root   14u     unix 0xffff88cac1310800       0t0    125570 socket</span><br><span class="line">kubelet 6914 root   15r  a_inode               0,10         0      6348 inotify</span><br><span class="line">kubelet 6914 root   16u     unix 0xffff88c91a133000       0t0 230272123 socket</span><br><span class="line">kubelet 6914 root   17u     unix 0xffff88c93dcb8c00       0t0    125528 socket</span><br><span class="line">kubelet 6914 root   18u     unix 0xffff88ca93e43800       0t0    125529 socket</span><br><span class="line">kubelet 6914 root   19u     unix 0xffff88c93dcbb800       0t0    122620 /var/run/387454838</span><br><span class="line">kubelet 6914 root   20u     unix 0xffff88ca93e40c00       0t0    122621 /var/run/387454838</span><br><span class="line">kubelet 6914 root   21r  a_inode               0,10         0      6348 inotify</span><br><span class="line">kubelet 6914 root   22u  a_inode               0,10         0      6348 [eventpoll]</span><br><span class="line">kubelet 6914 root   23r     FIFO                0,9       0t0    125542 pipe</span><br><span class="line">kubelet 6914 root   24w     FIFO                0,9       0t0    125542 pipe</span><br><span class="line">kubelet 6914 root   25r      CHR               1,11       0t0      6358 /dev/kmsg</span><br><span class="line">kubelet 6914 root   26u     IPv6             124463       0t0       TCP *:10250 (LISTEN)</span><br><span class="line">kubelet 6914 root   27u     unix 0xffff88caebebd800       0t0    125589 /var/lib/kubelet/device-plugins/kubelet.sock</span><br><span class="line">kubelet 6914 root   28u     unix 0xffff88cac1313c00       0t0    125549 /var/lib/kubelet/pod-resources/283926109</span><br><span class="line">kubelet 6914 root   29u     IPv4             125551       0t0       TCP localhost:10248 (LISTEN)</span><br><span class="line">kubelet 6914 root   30u     unix 0xffff88ca83a21400       0t0 229931580 socket</span><br><span class="line">kubelet 6914 root   31r  a_inode               0,10         0      6348 inotify</span><br><span class="line">kubelet 6914 root   33r      CHR               1,11       0t0      6358 /dev/kmsg</span><br><span class="line">kubelet 6914 root   34r  a_inode               0,10         0      6348 inotify</span><br><span class="line">kubelet 6914 root   35u  a_inode               0,10         0      6348 [eventpoll]</span><br><span class="line">kubelet 6914 root   36r     FIFO                0,9       0t0    125593 pipe</span><br><span class="line">kubelet 6914 root   37w     FIFO                0,9       0t0    125593 pipe</span><br><span class="line">kubelet 6914 root   38u     unix 0xffff88cac1386000       0t0    124529 socket</span><br><span class="line">kubelet 6914 root   39u     unix 0xffff88caf6d00c00       0t0    123724 socket</span><br><span class="line">kubelet 6914 root   43u     IPv4          168915864       0t0       TCP kubernetes.cluster.local.lb:38676-&gt;kubernetes.cluster.local.lb:16443 (ESTABLISHED)</span><br></pre></td></tr></table></figure>



<ul>
<li>fd  ——&gt; 文件描述符（变量）</li>
</ul>
<hr>
<h4 id="传输控制层"><a href="#传输控制层" class="headerlink" title="传输控制层"></a>传输控制层</h4><p><img src="/images/tcp-2.png" alt="tcp-2"></p>
<p>tcp/udp（传输控制层）</p>
<p>上面网络层为应用层，应用层基于 <code>传输控制层</code> 建立的连接，来进行数据传输</p>
<p>！连接是什么？连接如何建立？</p>
<p><img src="/images/tcp-3.png" alt="tcp-3"></p>
<p>连接，就是双方都有资源，能够为双方的应用提供服务，进行数据传输。</p>
<p>tcp/udp连接，虚拟概念，底层由内核文件系统 + 数据io + 更底层网络协议实现</p>
<hr>
<p>tcp：面向连接可靠的传输协议</p>
<ul>
<li>建立连接：</li>
</ul>
<p>三次握手：client 发出 syn —— server 返回 syn + ack —— client发出 ack ——&gt;</p>
<ul>
<li>数据传输：</li>
</ul>
<p>client &amp; server 申请一定资源，建立连接通信进行数据传输 ——&gt;</p>
<ul>
<li>断开连接：</li>
</ul>
<p>四次分手：双方socket资源释放</p>
<p>client 发出fin—— server 返回 fin + ack—— server发出 fin —— client发出 ack。（到此结束）</p>
<p>！三次握手、四次分手过程中，发出的信号包（例如ack确认），长度都为 0</p>
<p><img src="/images/tcp-4.png" alt="tcp-4"></p>
<p>socket ——&gt; [client ip:client port -&gt; server-ip:server port]  四元组</p>
<p>不同ip服务器同个端口，均可以建立 65535 个连接</p>
<p><img src="/images/tcp-5.png" alt="tcp-5"></p>
<hr>
<p>查看操作系统网络状态 netstat</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">netstat -natp</span><br><span class="line"></span><br><span class="line"># 示例</span><br><span class="line">[root@master1 ~]# netstat -natp</span><br><span class="line">Active Internet connections (servers and established)</span><br><span class="line">Proto Recv-Q Send-Q Local Address           Foreign Address         State       PID&#x2F;Program name</span><br><span class="line">tcp        0      0 127.0.0.1:10259         0.0.0.0:*               LISTEN      26858&#x2F;kube-schedule</span><br><span class="line">tcp        0      0 127.0.0.1:42420         0.0.0.0:*               LISTEN      6914&#x2F;kubelet</span><br><span class="line">tcp        0      0 0.0.0.0:22              0.0.0.0:*               LISTEN      3365&#x2F;sshd</span><br><span class="line">tcp        0      0 127.0.0.1:25            0.0.0.0:*               LISTEN      3862&#x2F;master</span><br><span class="line">tcp        0      0 0.0.0.0:16443           0.0.0.0:*               LISTEN      28115&#x2F;haproxy</span><br><span class="line">tcp        0      0 127.0.0.1:9182          0.0.0.0:*               LISTEN      11322&#x2F;.&#x2F;bin&#x2F;k8s-key</span><br><span class="line">tcp        0      0 0.0.0.0:9119            0.0.0.0:*               LISTEN      28115&#x2F;haproxy</span><br><span class="line">tcp        0      0 0.0.0.0:8067            0.0.0.0:*               LISTEN      28115&#x2F;haproxy</span><br><span class="line">tcp        0      0 127.0.0.1:10248         0.0.0.0:*               LISTEN      6914&#x2F;kubelet</span><br><span class="line">tcp        0      0 0.0.0.0:8073            0.0.0.0:*               LISTEN      28115&#x2F;haproxy</span><br><span class="line">tcp        0      0 127.0.0.1:10249         0.0.0.0:*               LISTEN      2848&#x2F;kube-proxy</span><br><span class="line">tcp        0      0 0.0.0.0:8074            0.0.0.0:*               LISTEN      28115&#x2F;haproxy</span><br><span class="line">tcp        0      0 127.0.0.1:2381          0.0.0.0:*               LISTEN      1576&#x2F;etcd</span><br><span class="line">tcp        0      0 127.0.0.1:10257         0.0.0.0:*               LISTEN      26883&#x2F;kube-controll</span><br><span class="line">tcp        0      0 0.0.0.0:30001           0.0.0.0:*               LISTEN      28115&#x2F;haproxy</span><br><span class="line">tcp        0      0 127.0.0.1:46448         127.0.0.1:9180          TIME_WAIT   -</span><br><span class="line">tcp        0      0 127.0.0.1:46816         127.0.0.1:9180          TIME_WAIT   -</span><br><span class="line">tcp        0      0 127.0.0.1:45914         127.0.0.1:9180          TIME_WAIT   -</span><br><span class="line">tcp        0      0 127.0.0.1:2381          127.0.0.1:41694         TIME_WAIT   -</span><br><span class="line">tcp        0      0 127.0.0.1:46886         127.0.0.1:9180          TIME_WAIT   -</span><br><span class="line">tcp        0      0 127.0.0.1:57580         127.0.0.1:2379          ESTABLISHED 1538&#x2F;kube-apiserver</span><br><span class="line">tcp        0      0 127.0.0.1:57478         127.0.0.1:2379          ESTABLISHED 1538&#x2F;kube-apiserver</span><br><span class="line">tcp        0      0 127.0.0.1:57594         127.0.0.1:2379          ESTABLISHED 1538&#x2F;kube-apiserver</span><br></pre></td></tr></table></figure>



<p>在 tcp/udp 连接的传输过程中，任何一方发出 数据包，另一方都要发出 ack 确认动作</p>
<p><img src="/images/tcp-6.png" alt="tcp-6"></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tcpdump -i (设备名) nn(非机密信息掩饰) port (端口) -X(可选，是否查看数据包内具体内容)</span><br></pre></td></tr></table></figure>



<p><img src="/images/tcp-7.png" alt="tcp-7"></p>
<hr>
<p>nc程序，可以与指定 ip + port 建立连接。nc客户端执行 get、post、put请求。四次分手，可以 FIN和ACK包一起发，只需要3次</p>
<p>建立连接过程中，tcp/udp连接建立会带有 <code>?</code> 因为数据包的收发还依赖底层（网络层[数据包收发形式]）</p>
<hr>
<h4 id="网络层"><a href="#网络层" class="headerlink" title="网络层"></a>网络层</h4><ul>
<li><p>IP</p>
</li>
<li><p>route</p>
</li>
</ul>
<p>互联网（很多小的网络互相连接起来），主机IP访问（网络号+主机位）</p>
<p>/etc/sysconfig/network-scripts/ifcfg-eth0</p>
<p>IPADDR ip地址</p>
<p>NETMASK 掩码</p>
<p>GATEWAY 网关</p>
<p>DNS 域名解析服务器</p>
<p>IP + NETMASK 与运算，得到——网络号</p>
<p>路由表</p>
<p>查看路由表</p>
<p>GATEWAY 0.0.0.0，即不需要 走 路由器/网关（即无需下一跳），网络直连，直接与同网段 ip 节点互相通信</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[root@master1 ~]# route -n</span><br><span class="line">Kernel IP routing table</span><br><span class="line">Destination     Gateway         Genmask         Flags Metric Ref    Use Iface</span><br><span class="line">0.0.0.0         10.33.41.254    0.0.0.0         UG    0      0        0 eth0</span><br><span class="line">10.33.41.0      0.0.0.0         255.255.255.0   U     0      0        0 eth0</span><br><span class="line">10.244.0.0      0.0.0.0         255.255.255.0   U     0      0        0 cni0</span><br><span class="line">10.244.1.0      10.244.1.0      255.255.255.0   UG    0      0        0 flannel.1</span><br><span class="line">10.244.2.0      10.244.2.0      255.255.255.0   UG    0      0        0 flannel.1</span><br><span class="line">10.244.5.0      10.244.5.0      255.255.255.0   UG    0      0        0 flannel.1</span><br><span class="line">10.244.6.0      10.244.6.0      255.255.255.0   UG    0      0        0 flannel.1</span><br><span class="line">169.254.0.0     0.0.0.0         255.255.0.0     U     1002   0        0 eth0</span><br><span class="line">172.17.0.0      0.0.0.0         255.255.0.0     U     0      0        0 docker0</span><br></pre></td></tr></table></figure>



<p>路由表</p>
<p>作用：</p>
<p>记录当前局域网（局部互联网）所有的连接信息，为 网络路由（网关节点、路由器、流量发出节点） 提供下一跳的 依据</p>
<p>原理：</p>
<p>网络中下一跳点，必有流量入口，另外一个流量出口</p>
<p>举例：</p>
<p>发送给百度数据包。（本机ip 192.168.150.2，百度ip 61.135.169.121），对于发送到外部网络的流量</p>
<p>通过 <code>Genmask</code> 掩码进行与运算匹配</p>
<p>1）255.255.255.0  计算后 得到  目标地址：192.168.150.0 为当前网络段，网络直连。</p>
<p>2）0.0.0.0 计算后 得到 0.0.0.0，即目标地址为 0.0.0.0，走到网关 192.168.150.0，由网关/路由器所在节点决定网络下一跳。</p>
<p>走 <code>Iface</code> 设备 流量出入，走到 网关/路由器所在节点，决定下一跳地址。</p>
<p>此时发送的目标地址为 61.135.169.121，为了保证这个数据包能够发送到 网关节点，需要为数据包的 目的地址、端口 提供 额外地址信息，即网关/路由器 节点的 MAC 地址（即链路层协议在 网络层数据包外  添加 自身数据包 封装）</p>
<p>数据包发到 服务端，根据 目的ip 发送到指定处理的节点，根据 目标端口，查找在服务器上的对应进程，并进行 数据处理，实现 进程与进程间网络通信。</p>
<p><img src="/images/tcp-8.png" alt="tcp-8"></p>
<hr>
<h4 id="链路层"><a href="#链路层" class="headerlink" title="链路层"></a>链路层</h4><p>链路层地址数据库维护</p>
<p>查看该数据库 arp -a</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[root@master1 ~]# arp -a</span><br><span class="line">? (172.17.0.2) at 02:42:ac:11:00:02 [ether] on docker0</span><br><span class="line">node1 (10.33.41.135) at fa:16:3e:99:4b:46 [ether] on eth0</span><br><span class="line">kubernetes.cluster.local.lb (10.33.41.130) at &lt;incomplete&gt; on eth0</span><br><span class="line">? (10.33.41.250) at 50:98:b8:19:af:1f [ether] on eth0</span><br><span class="line">node2 (10.33.41.136) at fa:16:3e:8f:eb:a6 [ether] on eth0</span><br><span class="line">? (10.33.41.131) at e8:61:1f:21:87:c9 [ether] on eth0</span><br><span class="line">? (10.33.41.251) at 74:ea:cb:2d:cd:68 [ether] on eth0</span><br><span class="line">master1 (10.33.41.126) at fa:16:3e:8f:eb:a6 [ether] on eth0</span><br><span class="line">? (10.33.41.137) at fa:16:3e:1a:2e:f3 [ether] on eth0</span><br></pre></td></tr></table></figure>



<p>找到 目标设备网卡的 MAC 地址。</p>
<p><img src="/images/tcp-9.png" alt="tcp-9"></p>
<p>例如，访问 <a target="_blank" rel="noopener" href="http://www.baidu.com/">www.baidu.com</a></p>
<p>从 client端发起网络请求，请求数据包—— 百度服务器的IP地址和 （家内/小区内）路由器 的 MAC 地址 </p>
<p>中间路由器——将请求数据包（ 目标ip、端口不变，修改目标MAC地址）</p>
<p>中间服务器到百度服务器——百度服务器ip地址和端口 &amp; 百度服务器MAC地址</p>
<p>类似链表结构（每次原数据不变化，跳转地址变化）</p>
<hr>
<p>ip 路由表 本身可以有记录（系统启动时，读取网卡配置项即可）</p>
<p>路由表信息——也称 静态路由。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">网关代表下一跳！ Next Jump</span><br></pre></td></tr></table></figure>





<p>arp mac相关地址信息无记录，必须通过网络请求后，请求完成后添加、更新记录。</p>
<p>即，第一次发出数据包/网络请求时，arp会请求 目标ip节点 的 MAC 地址。</p>
<p>问题？当arp申请mac地址时，它不知道目标 ip的 mac 地址，如何将包发给正确 mac 地址，然后申请获得目标ip的 mac信息呢？</p>
<p>—— arp会广播给局域网所有节点（广播MAC地址为 全 ff 的MAC 地址），仅目标 ip 的 mac 会响应，以此发现目标ip的mac地址</p>
<p>所以，为什么网络是分层的？</p>
<p>层和层之间有依赖关系。</p>
<p>！！！</p>
<p>因此，第一次建立连接前，即三次握手前，需要 发出 <code>arp 请求</code>，获取目标MAC地址</p>
<p>获取到MAC地址后，才开始 三次握手 等 tcp/ip 层网络连接</p>
<p>示例命令：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">arp -d 192.168.150.2 &amp;&amp; curl www.baidu.com</span><br></pre></td></tr></table></figure>





<img src="/images/tcp-10.png" alt="tcp-10" />

<p><img src="/images/tcp-11.png" alt="tcp-11"></p>
<p>网络方面，-n / -nn 为是否展示详细信息</p>
<hr>
<p><img src="/images/tcp-12.png" alt="tcp-12"></p>
<p>回环设备——Loop Device</p>
<p>路由表规划不对，需要网工（人为维护）——SDN的源头</p>
<p><img src="/images/tcp-13.png" alt="tcp-13"></p>
<p><img src="/images/tcp-14.png" alt="tcp-14"></p>
<p>有了网络知识，才能入坑并发时，socket处理，以及并行度相关知识</p>
<p>网络——》并发——》并行度</p>
<hr>
<p>交换机、路由器、网关的关系？</p>
<p>路由器：三层设备，存有路由表，看IP地址</p>
<p>交换机：二层设备，物理层/链路层，看MAC地址，不能作为两个网络区域 连接的使用</p>
<p>家用路由器：交换机+路由器结合，四个插口为交换机口；路由器接两条线，一条接交换机、一条接ISP运营商</p>
<p>NAT：地址转换协议</p>
<hr>
<p>高薪程序员：M+N（内在和外在兼修）</p>
<p>M：个人修行</p>
<p>设计模式</p>
<p>多线程 + 高并发 JUC</p>
<p>网络到分布式：redis、zookeeper、elasticsearch、mq</p>
<p>调优：OSKernel</p>
<p>N：项目经验，即场景</p>
<p>整合《——》技术《——》问题</p>
<p>技术：落地到应用场景</p>
<hr>
<p>一个问题：技术选项——技术特征、原理、源码、！场景！</p>
<hr>
<p>整合一些技术，再解决问题。——<code>结合点</code></p>
<hr>
<p>在实际工作中   辩证    实践验证技术特征、能力。</p>
<p>例如 ssm，需要高并发，引入负载均衡（lvs）</p>
</div></article></div></div><div class="column column-left is-4-tablet is-4-desktop is-4-widescreen  order-1"><div class="card widget" data-type="profile"><div class="card-content"><nav class="level"><div class="level-item has-text-centered flex-shrink-1"><div><figure class="image is-128x128 mx-auto mb-2"><img class="avatar" src="/img/1.jpg" alt="wikix"></figure><p class="title is-size-4 is-block" style="line-height:inherit;">wikix</p><p class="is-size-6 is-block">System developer</p><p class="is-size-6 is-flex justify-content-center"><i class="fas fa-map-marker-alt mr-1"></i><span>Hangzhou (ZH)</span></p></div></div></nav><nav class="level is-mobile"><div class="level-item has-text-centered is-marginless"><div><p class="heading">Posts</p><a href="/archives"><p class="title">4</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">Categories</p><a href="/categories"><p class="title">4</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">Tags</p><a href="/tags"><p class="title">4</p></a></div></div></nav><div class="level"><a class="level-item button is-primary is-rounded" href="https://github.com/wikix" target="_blank" rel="noopener">Follow</a></div><div class="level is-mobile is-multiline"><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Github" href="https://github.com/wikix"><i class="fab fa-github"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Gmail" href="/wikiios145@gmail.com"><i class="fab fa-google"></i></a></div></div></div><!--!--><div class="card widget" data-type="links"><div class="card-content"><div class="menu"><h3 class="menu-label">Links</h3><ul class="menu-list"><li><a class="level is-mobile" href="https://github.com/wikix" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">Github</span></span><span class="level-right"><span class="level-item tag">github.com</span></span></a></li></ul></div></div></div><div class="card widget" data-type="categories"><div class="card-content"><div class="menu"><h3 class="menu-label">Categories</h3><ul class="menu-list"><li><a class="level is-mobile" href="/categories/container/"><span class="level-start"><span class="level-item">container</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/distribution/"><span class="level-start"><span class="level-item">distribution</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/kubernetes-container/"><span class="level-start"><span class="level-item">kubernetes, container</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/network/"><span class="level-start"><span class="level-item">network</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li></ul></div></div></div><div class="card widget" data-type="recent-posts"><div class="card-content"><h3 class="menu-label">Recents</h3><article class="media"><div class="media-content"><p class="date"><time dateTime="2021-03-08T16:17:05.000Z">2021-03-08</time></p><p class="title"><a href="/2021/03/09/TCP-IP-%E7%9F%A5%E8%AF%86%E7%82%B9/">TCP/IP 知识点</a></p><p class="categories"><a href="/categories/network/">network</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2021-03-08T16:06:40.000Z">2021-03-08</time></p><p class="title"><a href="/2021/03/09/flagger-%E8%A7%A3%E6%9E%90/">flagger 解析</a></p><p class="categories"><a href="/categories/kubernetes-container/">kubernetes, container</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2021-03-08T16:02:14.000Z">2021-03-08</time></p><p class="title"><a href="/2021/03/09/ceph-%E5%85%A5%E9%97%A8%E7%AC%94%E8%AE%B0/">ceph 入门笔记</a></p><p class="categories"><a href="/categories/distribution/">distribution</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2021-03-08T16:00:16.000Z">2021-03-08</time></p><p class="title"><a href="/2021/03/09/docker-pull%E9%97%AE%E9%A2%98%E6%8E%92%E6%9F%A5/">docker pull问题排查</a></p><p class="categories"><a href="/categories/container/">container</a></p></div></article></div></div><div class="card widget" data-type="archives"><div class="card-content"><div class="menu"><h3 class="menu-label">Archives</h3><ul class="menu-list"><li><a class="level is-mobile" href="/archives/2021/03/"><span class="level-start"><span class="level-item">March 2021</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li></ul></div></div></div><div class="card widget" data-type="tags"><div class="card-content"><div class="menu"><h3 class="menu-label">Tags</h3><div class="field is-grouped is-grouped-multiline"><div class="control"><a class="tags has-addons" href="/tags/ceph-storage/"><span class="tag">ceph, storage</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/docker/"><span class="tag">docker</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/kubernetes-crd-publish/"><span class="tag">kubernetes, crd, publish</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/network-tcp-ip/"><span class="tag">network, tcp/ip</span><span class="tag">1</span></a></div></div></div></div></div></div><!--!--></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start"><a class="footer-logo is-block mb-2" href="/"><img src="/img/favicon.svg" alt="wikix" height="28"></a><p class="is-size-7"><span>&copy; 2021 wikix</span>  Powered by <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a> &amp; <a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank" rel="noopener">Icarus</a></p></div><div class="level-end"><div class="field has-addons"><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Creative Commons" href="https://creativecommons.org/"><i class="fab fa-creative-commons"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Attribution 4.0 International" href="https://creativecommons.org/licenses/by/4.0/"><i class="fab fa-creative-commons-by"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Follow me on GitHub" href="https://github.com/wikix"><i class="fab fa-github"></i></a></p></div></div></div></div></footer><script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script><script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" defer></script><script>moment.locale("en");</script><script>var IcarusThemeSettings = {
            article: {
                highlight: {
                    clipboard: true,
                    fold: 'unfolded'
                }
            }
        };</script><script src="/js/column.js"></script><script src="/js/animation.js"></script><a id="back-to-top" title="Back to top" href="javascript:;"><i class="fas fa-chevron-up"></i></a><script src="/js/back_to_top.js" defer></script><!--!--><!--!--><!--!--><script src="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.js" defer></script><script>window.addEventListener("load", () => {
      window.cookieconsent.initialise({
        type: "info",
        theme: "edgeless",
        static: false,
        position: "bottom-left",
        content: {
          message: "This website uses cookies to improve your experience.",
          dismiss: "Got it!",
          allow: "Allow cookies",
          deny: "Decline",
          link: "Learn more",
          policy: "Cookie Policy",
          href: "https://www.cookiesandyou.com/",
        },
        palette: {
          popup: {
            background: "#edeff5",
            text: "#838391"
          },
          button: {
            background: "#4b81e8"
          },
        },
      });
    });</script><script src="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/js/lightgallery.min.js" defer></script><script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/js/jquery.justifiedGallery.min.js" defer></script><script>window.addEventListener("load", () => {
            if (typeof $.fn.lightGallery === 'function') {
                $('.article').lightGallery({ selector: '.gallery-item' });
            }
            if (typeof $.fn.justifiedGallery === 'function') {
                if ($('.justified-gallery > p > .gallery-item').length) {
                    $('.justified-gallery > p > .gallery-item').unwrap();
                }
                $('.justified-gallery').justifiedGallery();
            }
        });</script><!--!--><!--!--><!--!--><!--!--><!--!--><script src="/js/main.js" defer></script><div class="searchbox"><div class="searchbox-container"><div class="searchbox-header"><div class="searchbox-input-container"><input class="searchbox-input" type="text" placeholder="Type something..."></div><a class="searchbox-close" href="javascript:;">×</a></div><div class="searchbox-body"></div></div></div><script src="/js/insight.js" defer></script><script>document.addEventListener('DOMContentLoaded', function () {
            loadInsight({"contentUrl":"/content.json"}, {"hint":"Type something...","untitled":"(Untitled)","posts":"Posts","pages":"Pages","categories":"Categories","tags":"Tags"});
        });</script></body></html>